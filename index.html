<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ‚Ä¶ tu <head> tal cual (fonts, estilos, axios, firebase-app-compat, firestore-compat) ‚Ä¶ -->
</head>
<body>
  <!-- ‚Ä¶ todo tu body con login, secciones, tabla ‚Ä¶ -->

<script>
  // ya tienes db, usuarioActivo, etc.

  async function procesarConOpenAI() {
    const texto = document.getElementById("descripcionGasto").value.trim();
    if (!usuarioActivo) return mostrarError("‚ö†Ô∏è Primero selecciona un usuario");
    if (!texto)      return mostrarError("‚ö†Ô∏è Describe el gasto");

    try {
      // Llama a tu Flask
      const resp = await axios.post('http://TU_SERVIDOR:5000/api/addExpense', {
        texto,
        usuario: usuarioActivo
      });
      if (resp.data.success) {
        document.getElementById("descripcionGasto").value = "";
        imagenBase64 = null;
        document.getElementById("preview").src = "";
        mostrarExito("‚úÖ Gasto procesado correctamente");
        cargarGastos();
      } else {
        mostrarError("‚ùå " + JSON.stringify(resp.data));
      }
    } catch (err) {
      console.error(err);
      mostrarError(`‚ùå ${err.response?.data?.error || err.message}`);
    }
  }

  // Ajusta cargarGastos() para llamar GET /api/listExpenses
  async function cargarGastos() {
    try {
      const resp = await axios.get('http://TU_SERVIDOR:5000/api/listExpenses');
      const docs = resp.data;
      document.getElementById("tablaGastos").innerHTML =
        docs.map(d => `
          <tr>
            <td>${d.fecha}</td>
            <td>${d.concepto}</td>
            <td>$${d.monto}</td>
            <td>${d.proyecto}</td>
            <td>
              <button onclick="eliminarGasto('${d.id}')">üóë</button>
            </td>
          </tr>
        `).join('');
    } catch (e) {
      mostrarError(`‚ùå ${e.message}`);
    }
  }
</script>
</body>
</html>
